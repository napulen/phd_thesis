% Copyright 2022 Néstor Nápoles López

The different components of the \gls{rna} string have a
hierarchical structure. The tonicization $\eldenpred$ is
relative to the key $\elkeypred$. The numerator $\elnumpred$
is relative to the tonicized key $\eldenpred$. The inversion
$\elinvpred$ relies on the bass note (\gls{bass35}) in the
context of the chord of the numerator $\elnumpred$. Taking
the hierarchical structure into account, the components of
the \gls{rna} label need to be resolved in the following
way:

\begin{enumerate} 
    \item The key $\elkeypred$ is taken directly from the
    \gls{localkey38} classifier 
    \item The tonicization $\eldenpred$ is a key prediction
    from \gls{tonicization38}, but needs to be encoded as a
    relative scale degree of the key $\elkeypred$
    \item The numerator $\elnumpred$ is a chord resolved
    from the key of the tonization $\eldenpred$ 
    \item The inversion $\elinvpred$ is a stack of Arabic
    numerals determined from the position of the bass note
    \gls{bass35} in the chord implied by $\elnum$ and
    whether $\elnum$ is a triad or seventh chord
\end{enumerate}

\phdparagraph{encoding the tonicization}

The tonicization is encoded as a scale degree relative to
the key $\elkeypred$, as shown in
\reftab{directmethod_rna_tonicization}.

\phdtable[Resolving the encoding of tonicizations]{directmethod_rna_tonicization}

\phdparagraph{resolving the chord}

A preliminary step before generating the inversion
accompanying the numerator $\elnumpred$ is to find the chord
implied by the numerator $\elnumpred$. The numerator is
always interpreted in the context of the tonicization
$\eldenpred$. This is shown in
\reftab{directmethod_rna_chord}.

\phdtable[Resolving the chord implied by
$\elnum$]{directmethod_rna_chord}

\phdparagraph{encoding the inversion}

The inversion is derived from the prediction $\elbasspred
\in \setps_{35}$ of the \gls{bass35} classifier. When the
notes of the chord implied by the Roman numeral numerator
$\elnumpred$ are known, the bass $\elbasspred$ can be
searched in the chord. The position of the note in the chord
indicates the inversion number. The quality of the chord
(triad or seventh), determines the stack of Arabic numerals
used to encode the inversion. This process is shown in
\reftab{directmethod_rna_inversion}.

\phdtable[Resolving the inversion
$\elinvpred$]{directmethod_rna_inversion}

After the inversion is resolved, all the components for the
\gls{rna} label annotation are ready to be assembled in the
\gls{rna} syntax. The resulting annotations are shown in
\reftab{directmethod_rna_complete} 

\phdtable[Resolving the \gls{rna} label
$\elrnapred$]{directmethod_rna_inversion}
