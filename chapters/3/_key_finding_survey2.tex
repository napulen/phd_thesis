% Taken verbatim from On Local Keys, Modulations, and
% Tonicizations

Throughout the common-practice period (1650--1900), it is
customary to find changes of musical key within a piece of
music. In current music theory terminology, the concepts of
\emph{modulation} and \emph{tonicization} are helpful to
explain many of these changes of key. Conversely, in
computational musicology and music information retrieval,
the preferred way to denote changes of key are \emph{local
key} features, which are oftentimes predicted by
computational models. Therefore, the three concepts, local
keys, modulations, and tonicizations describe changes of
key. What is, however, the relationship between the local
keys, modulations, and tonicizations of the same musical
fragment?


Key identification is a fundamental task in the analysis of
tonal music. It is often a preliminary or concurrent step to
other common musicological tasks like harmonic analysis and
cadence detection. In particular, the knowledge of the
musical key can help a music analyst to find boundaries in a
musical piece, interpret the role of notes and chords, or
suggest a musical form to which the analyzed piece conforms.
Due to its importance, key estimation is a well-studied
research topic in Music Information Retrieval (MIR), and
multiple key-analysis algorithms have emerged during the
last decades. Broadly, there are two types of key-estimation
algorithms: those that find the \emph{main key} of the piece
(often called \emph{global-key-estimation} models in the
context of computational musicology and MIR), and those that
find the changes of key \emph{within} the piece (often
called \emph{local-key-estimation} models). The annotations
provided by these models have found applications in music
technologies.

Changes of key may belong to different categories. In music
theory, terms like \emph{modulation} and \emph{tonicization}
are helpful for interpreting the context of a change of key.
Yet, most local-key-estimation research omits an
investigation of the relationship between local-key
annotations and these categories of changes of key.
Therefore, as they stand, local-key annotations lack the
characteristics that would make them useful in real
applications, such as searching for the musical pieces in a
large database that showcase similar modulation or
tonicization patterns. One could think that these queries
would be interesting, and quite different to, for example,
searching for pieces of music that share the same global
key.

\guide{Global-Key-Estimation Models}
Researchers have designed a number of global-key-estimation
algorithms throughout the years. The first one, to our
knowledge, is the one by
Longuet-Higgins~\cite{longuet1971tonality} from 1971.
Starting from the beginning of a score, the algorithm
considers each pitch in order of occurrence and discards the
keys that do not include that pitch within their diatonic
scale degrees. This process is repeated until only one key
remains, and some heuristics are applied afterward to help
with the most difficult cases. This algorithm was able to
retrieve the key of the fugues in J. S. Bach's
\emph{Well-tempered Clavier}. It also served as a reference
for later models, such as the one by Vos and van
Geenen~\cite{vos96keyfinding}.

With the introduction of the \emph{probe-tone} technique and
\emph{key profiles} in 1979
\cite{krumhansl1979quantification}, and their later
application to the design of a global-key-estimation
algorithm in 1990 \cite{krumhansl1990cognitive}, research
regarding global-key-estimation models saw a shift toward
more \emph{distributional} approaches
\cite{temperley2008pitch}. Key profiles, originally
introduced as listener ratings by Krumhansl et al.
\cite{krumhansl1979quantification, krumhansl1982tracing},
have transitioned into probability distributions that can be
used to predict the key of a musical piece. Alternative
key-profile distributions---and techniques for applying
them---have been proposed over the years.

Key profiles are the basis of many global-key-estimation
models for symbolic music files and, starting from the
2000s, audio files as well. More exhaustive surveys of
modern global-key-estimation techniques, with a focus on
audio, are available \cite{korzeniowski2018harmonic,
campbell2010automatic}. Key profiles have also been useful
in the design of local-key estimation models.

\guide{Local Keys, Modulation, and
Tonicization}\label{ssec:terminology}

In MIR, it is common to describe algorithms that model
\emph{changes of key} as local-key-estimation algorithms.
The \emph{local keys} being the predictions that these
models generate. Conversely, in music theory, the concepts
of \emph{modulation} and \emph{tonicization} are often the
manner in which changes of key are explained, and the term
\emph{local key} is virtually non-existent.

Therefore, the three concepts, local keys, modulations, and
tonicizations describe changes of key. Yet, what is the
meaning of these terms? And what is the relationship between
the local keys, modulations, and tonicizations of the same
musical fragment?

According to the Grove Music Online dictionary, a modulation
``refers to a firmly established change of key, as opposed
to a passing reference to another key, known as a
`tonicization' ''~\cite{saslawgrovemodulation}. Moreover, a
tonicization is ``the act of establishing a new key centre,
or of giving a degree other than the first the role of
tonic''~\cite{drabkintonicization}.

A formal definition of local keys is difficult to find.
According to Papadopoulos et
al.~\cite{papadopoulos2009local}, a local key is the ``key
of each segment'' of a ``[segmented] musical piece [...]
according to the points of modulation''.

However, after these definitions, it is still difficult to
understand the distinction between modulations and
tonicizations. Kostka and Payne have suggested that such
distinction is not possible: ``The line between modulation
and tonicization is not clearly defined in tonal music, nor
is it meant to be'' \cite{kostka2008tonal}.

Regarding local keys, most researchers, as Papadopoulos et
al. \cite{papadopoulos2009local}, associate them with
modulations, however, this relationship has not been
explored sufficiently. It would certainly benefit the
computational musicology and MIR communities to engage in
this exploration, in order to understand what is it that
local-key-estimation algorithms predict.

For the scope of this work, we define these terms as
follows:

\guide{Modulation}
Is the change from one key to another. We refer to the
initial key as the \emph{departure} key, and the second key
as the \emph{destination} key.

\guide{Tonicization}
Is a brief deviation to a different key, usually with the
intention of emphasizing a certain scale degree or harmony.
The tonicization often returns to the original key briefly
after the deviation.

\guide{Local keys}
Are the predictions of the musical key provided by a
local-key-estimation algorithm. These predictions are given
at a finer level of granularity than the entire piece (e.g.,
notes, onsets, fixed-duration timesteps, audio frames,
etc.). In principle, no music-theoretical meaning is
inferred from them. They may coincide with modulations or
tonicizations.

\guide{Local-Key-Estimation Models}\label{ssec:localkey}

Contrary to the global-key estimation approaches, local-key
estimation models have a relatively recent history.

% Audio
Purwins et al. introduced a method for tracking changes of
key in audio signals %using cq-profiles, which are
calculated with the constant Q filter bank
\cite{purwins2000new}. Their goal is to track the tone
center and its variation during the piece. Their references
annotate both modulations and tonicizations but consider
that the ground truth is the one indicated by the
tonicizations.

% symbolic
Chew~\cite{chew2002key} measured the distance from a
sequence of pitches to a key using the \emph{spiral array}
~\cite{chew2000towardsam}. The succession of keys is then
modeled as a sequence of \emph{boundaries} dividing the
score in different key areas.

% Audio
Chai and Vercoe designed a model based on a Hidden Markov
Model (HMM) to detect changes of
key~\cite{chai2005detection}. They describe the term
\emph{modulation} as ``the change of key at some point''.
Their model detects, at first, the tonal center, and then,
the mode of the key.

% Audio
Catteau et al.~\cite{catteau07tonalkey} introduced a model
for scale and chord recognition, assuming that there is a
correspondence between a major scale and a major key, and
between a harmonic minor scale and a minor key. Their model
is based on the key profiles by Temperley
\cite{temperley99tonality} and Lerdahl's \emph{tonal pitch
spaces} \cite{lerdahl88tps}.

Izmirli introduced a model to find local keys from audio
sources, based on non-negative matrix factorization for
segmentation~\cite{izmirli2007localized}. Izmirli also
attempted to disambiguate modulations and tonicizations in
the following manner: ``Secondary functions and
tonicizations are heard as short deviations from the
well-grounded key in which they appear---although the
boundary between modulation and tonicization is not clear
cut. A modulation unambiguously instigates a shift in the
key center''.
% This work is also, to our knowledge, the first time that
% the term \emph{local keys} has been mentioned in an MIR
% publication.

Papadopoulos and Peeters adopted a similar approach to
Izmirli for audio local-key estimation
\cite{papadopoulos2009local}. Their model attempts to
segment the score based on the points of modulation. They
introduced key dependencies on the harmonic and metric
structures of global-key-finding methods, in order to
convert them into local-key-finding ones.
% They also discussed the need for more data in chords and
% local key.

Rocher et al. introduced a model that provides (chord, key)
duples for each audio frame of an input excerpt. The model
is based on a graph and the \emph{best-path} estimation
method~\cite{thomas_rocher_2010_1417485}. For evaluating key
distances, they used the key profiles by
Temperley~\cite{temperley99tonality}. The authors alluded to
the term modulation when discussing their key predictions.

Mearns et al. used an HMM to estimate modulations over audio
transcriptions of Bach
chorales~\cite{mearns2011automatically}. The HMM is trained
with chord progressions. The emission probability
distributions are obtained from two tables with the
probabilities of chords existing in a given key. These
tables are based on the work by Schoenberg and Krumhansl.
Applied chords (i.e., tonicizations) are not described in
these charts, therefore, the authors do not deal with
tonicizations.

In 2014, Pauwels and Martens present a probabilistic
framework for the simultaneous estimation of chords and keys
from audio~\cite{pauwels2014combining}. They mention the
importance of ``integrating prior musical knowledge'' into a
local-key-estimation system, however, they do not allude to
the terms modulation and tonicization. The same year, Weiss
et al. proposed an audio scale
estimator~\cite{weiss2014chroma}. They argue that this
estimator can help to determine the local tonality based on
G\'{a}rdonyi's scale analysis method. They did not use the
term tonicization, however, they discussed ``short-time
local modulations'', which resemble tonicizations.

Machine learning approaches, especially using neural
networks, have recently gained popularity in MIR research,
including key estimation. Independently, Chen et al.
\cite{chen18harmony,chen19harmony} and Micchi et
al.~\cite{micchi20roman} designed models that estimate local
keys as well as roman numeral analysis annotations.
Tonicization information is implied by the roman numeral
analysis annotations.

N\'apoles L\'opez et al. introduced a model to find changes
of key (local-key estimation) as well as the main key of a
piece (global-key estimation), using an HMM
\cite{napoleslopez2019key}. The model is also capable of
working with symbolic and audio data. They do not allude to
the terms modulation or tonicization, always referring to
their predictions as \emph{local keys}.

One of the most recent models for finding changes of key is
by Feisthauer et al.~\cite{feisthauer2020smc}, which has
been designed to detect modulations in Classical music. It
uses three proximity measures established from pitch
compatibility, tonality anchoring, and tonality proximity.
The model computes the cost of being in a key on a given
beat, and estimates the succession of keys using dynamic
programming techniques.

% As modulations, tonicizations, and local keys all have
% different representations, they are difficult to compare.
% We propose a methodology to turn modulations and
% tonicizations into sequences of labels, a structure that
% is more compatible with local keys and facilitates the
% comparison between the music-theoretical concepts and the
% MIR annotations.

\guide{Existing Datasets to Evaluate Local-Key-Estimation Models}

Most of the models discussed have been evaluated using
different datasets, which are presented in
Table~\ref{tab:corpus}.

% \begin{table}
%   \caption{Datasets used to evaluate local-key-estimation models.}
%   \label{tab:corpus}
%   \begin{tabular}{lcl}
%     \toprule
%     Model&Files&Dataset\\
%     \midrule
%     Catteau~\cite{catteau07tonalkey} & 10 & Manually-built\\
%     & & chord sequences\\
%     Chai~\cite{chai2005detection} & 10 & Various
%     (Classical)\\
%     Chen~\cite{chen18harmony,chen19harmony},
%     Micchi~\cite{micchi20roman} & 23 & Beethoven\\
%     Chew~\cite{chew2002key} & 2 & Bach\\
%     Feisthauer~\cite{feisthauer2020smc} & 38 & Mozart
%     (Classical) \\
%     Izmirli~\cite{izmirli2007localized} & 17 & Pop songs\\
%     & 152 & Naxos set (Classical)\\
%     & 17 & Kostka-Payne (Classical)\\
%     Mearns~\cite{mearns2011automatically} & 12 & Bach
%     Chorales \\
%     Micchi~\cite{micchi20roman} &  27 &  TAVERN
%     (Classical)\\
%     & 70 & ABC (Beethoven)\\
%     & 72 & Roman Text (Classical)\\
%     Papadopoulos~\cite{papadopoulos2009local} & 5 & Mozart\\
%     Pauwels~\cite{pauwels2014combining} & 142 & SEMA Set
%     (Pop)\\
%     & 210 & MIREX 2009\\
%     Purwins~\cite{purwins2000new} and & 1 & Chopin\\
%     Napol\'{e}s Lop\'{e}z~\cite{napoleslopez2019key} & & \\
%     Rocher~\cite{thomas_rocher_2010_1417485} & 174 &
%     Beatles\\
%     Weiss~\cite{weiss2014chroma} & 10 & Various (Classical)
%     \\
%   \bottomrule
% \end{tabular}
% \end{table}

The datasets used for evaluating local-key-estimation
algorithms are typically small. Additionally, each dataset
has often been used to evaluate a single model, which makes
the comparison between models somewhat dubious. In this
paper, we contribute further discussion around this topic by
focusing on the following question: \emph{What is the
relationship between the local keys, modulations, and
tonicizations of the same musical fragment?} For this
purpose, we describe: (1) our methodology for comparing
annotations of local keys, modulations, and tonicizations,
(2) a dataset that we collected from five music theory
textbooks, and (3) an experiment where we evaluated three
existing local-key-estimation models.

\guide{Local keys and music theory}\label{sec:prob}

It is challenging to compare, in principle, local key
annotations---intrinsically subject to computational
considerations (e.g., input constraints or training
data)---to modulations and tonicizations, which are rooted
in music theory.

In order to achieve a comparison, an initial step involves
finding a common representation between local keys,
modulations, and tonicizations. For this purpose, we convert
an annotated score with the three classes of annotations
into a sequence of key labels that share the same level of
granularity. There are multiple ways to determine the
``slicing'' of the musical excerpt or level of granularity.
We opted for \emph{onsets}.\footnote{The precise moment when
a note (or simultaneously-sounding group of notes) is played
~\cite{bello05onset}.} That is, for every note \emph{onset}
in the score, we have a corresponding annotation of the key.
This level of granularity is especially convenient for
encoding roman numeral analysis annotations, the way in
which we encode the modulations and tonicizations in our
dataset.

% \begin{figure}[h]
%   \centering
%   \includegraphics[width=\linewidth]{figs/example-w-ambiguity}
%   \caption{Example 3-17b in Rimsky-Korsakov's
%   \emph{Practical Manual of Harmony} \cite{rimskitonality}.
%   Roman numeral annotations describe the harmonies on each
%   onset of the score and have been written by the theorist.
%   Some of the roman numeral annotations also indicate
%   tonicizations. These have been framed.}
%   \label{fig:example}
%   \Description{A sample score from Rimsky-Korsakov's
%   Practical Manual of Harmony.}
% \end{figure}

In Figure \ref{fig:example}, we introduce a musical score
with annotated modulations and tonicizations. Two
modulations are observed. The first one, departing from C
major and arriving to F major (measure 4). The second one,
departing from F major and returning to C major. Between the
two modulation events, the \emph{destination} key of one
modulation becomes the \emph{departure} key of the next
modulation.

Throughout the excerpt, there are also six tonicizations,
identified by the presence of at least one forward slash
symbol (``/'') in the roman numeral annotation.\footnote{The
slash is a conventional notation in roman numeral analysis
~\cite{Tymoczko2019, huron_representation}. The roman
numeral before the slash symbol denotes a chord, and the
roman numeral after the slash symbol denotes a tonicized
key.} The tonicizations that occur during the first
modulation (\emph{departure} key), deviate briefly from C
major to D minor (measure 1) and F major (measures 2 and 3);
the ones in the second modulation deviate from F major to C
major (measures 5 and 7).

Table \ref{tab:annotations} shows the generated
modulation-and-tonicization labels of every onset. There are
several conventions for digitally encoding roman numeral
annotations \cite{huron_representation, Tymoczko2019,
napoleslopez20harmalysis}. We opted for \emph{harmalysis}
\cite{napoleslopez20harmalysis}, an extension of
\emph{**harm} \cite{huron_representation}. Once the roman
numeral annotations have been digitally encoded within the
scores, it is fairly simple to retrieve the sequence of key
labels.

% \begin{table}[h]
%   \caption{Computer representation of the roman numeral
%   annotations of the excerpt in Figure \ref{fig:example}.
%   The modulation and tonicization columns are auto-generated
%   based on the roman numeral annotations. Each row is an
%   onset in the score. The position of the onset is indicated
%   at the first column of the table, as quarter notes from
%   the beginning of the score.}
%   \label{tab:annotations}
%   \begin{tabular}{c|lcc}
%     \toprule
%     Position&Annotation&Modulation&Tonicization\\
%     \midrule
%     0 & C=>:I & C major & C major \\
%     2 & viio7/ii & C major & D minor \\
%     4 & ii & C major & C major \\
%     6 & IV/IV & C major & F major \\
%     8 & V/IV & C major & F major \\
%     10 & V7/IV & C major & F major \\
%     12 & F=>:I6 & F major & F major \\
%     14 & V43 & F major & F major \\
%     16 & I & F major & F major \\
%     18 & V2/V & F major & C major \\
%     20 & V6 & F major & F major \\
%     22 & V & F major & F major \\
%     24 & I6 & F major & F major \\
%     26 & V7/V & F major & C major \\
%     28 & C=>:I & C major & C major \\
%    \bottomrule
% \end{tabular}
% \end{table}

\guide{Encoding Modulations}
We derive the ground-truth keys of the modulation column
based on the \emph{departure} keys. For every onset slice
before a \emph{destination} key is reached, the
\emph{departure} key is written as the ground-truth label of
that particular onset. Once a \emph{destination} key is
reached, it is considered to be the new \emph{departure}
key, and the process repeats.

In Table~\ref{tab:annotations}, the departure keys are
indicated by a key spelling followed by the token
``\texttt{=>:}''. Every modulation annotation is considered
in that key until a new one is indicated.

\guide{Encoding Tonicizations}~\label{sec:tonicization} We
derive the ground-truth keys of the tonicization column
based on the keys implied by the roman numeral annotations.
When there is no tonicization indication, the key is copied
from the modulation column. When the roman numeral implies a
different---tonicized---key, the ground-truth label is the
key implied by the roman numeral annotation. Using this
encoding strategy, we are able to compare local-key
predictions to modulation and tonicization annotations.

\guide{Key and Chord Ambiguity}~\label{sec:ambiguity}
Although we have centered the discussion around changes of
key, the line between an analysis of key changes and
harmonic analysis may be blurry. This is especially true for
tonicizations, which have a shorter temporal scope and often
emphasize a scale degree or even a specific harmony. Our
decision to encode tonicizations as roman numeral
annotations reflects this relationship.

There are datasets available with encoded roman numeral
analysis annotations \cite{neuwirth2018annotated,
devaney2015tavern, Tymoczko2019}, which could be used for
studying changes of key in the manner that we have presented
here. However, it is important to acknowledge that roman
numeral annotations are subject to issues such as ambiguity
and disagreement \cite{condit-schultz2018, koops19,
selway2020, arthur2017harmony}, which may have implications
for determining \emph{where} the changes of key occur. For
example, the dashed regions in Figure \ref{fig:example} show
the areas where the key is ambiguous. The exact position of
the ``arrival'' key within an ambiguous zone could,
potentially, vary from one analyst to another. This may have
implications for the modulation and tonicization
annotations.

In this work, we have tried to reduce the implications
related to the complexity of harmonic analysis by utilizing
a collection of scores that have been written or displayed
specifically to demonstrate modulations, mostly in the
manner of instructional or ``cherry-picked'' examples by the
authors of five music theory textbooks.

Most of the examples in the dataset are: (1) very short
(4--8 measures), (2) including at least one modulation, and
(3) often accompanied by text explanations written by the
theorists, which describe the modulation thoroughly.

We consider that these additional characteristics make this
dataset slightly more robust to the issues related to
disagreement and ambiguity. Therefore, they could be more
suitable for studying changes of key than existing roman
numeral analysis datasets.

% The annotations of the examples respected the theorist's
% key regions. We also utilized the text explanations to
% guide our encoding process.

% We followed this encoding procedure systematically across
% all the pieces of our dataset.
