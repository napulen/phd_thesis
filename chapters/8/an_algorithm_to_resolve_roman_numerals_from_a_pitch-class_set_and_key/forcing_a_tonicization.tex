% Copyright 2022 Néstor Nápoles López

Consider the case of $\Gamma(\elpcset, \elkey)$ when
$\elpcset = \pcsetcdFa$ and $\elkey = \keyC$. In that case,
$\elpcset$ has an associated numerator $\elnum \in \setnum$
with the subset of keys shown in \refeq{key_not_found}.
Thus, that subset of keys is $\setkey_\elpcset$, as shown in
\refeq{key_not_found2}. 

\begin{equation}
    \label{eq:key_not_found}
    \elpcset = \pcsetcdFa \text{ in key } \elkey =
    \begin{cases}
        \keyfs & \text{ is pcset}(\elkey\text{:}\elnum)\text{ if } \elnum = \rnGer \\
        \keyFs & \text{ is pcset}(\elkey\text{:}\elnum)\text{ if } \elnum = \rnGer \\
        \keygb & \text{ is pcset}(\elkey\text{:}\elnum)\text{ if } \elnum = \rnGer \\
        \keyg  & \text{ is pcset}(\elkey\text{:}\elnum)\text{ if } \elnum = \rnVsev \\
        \keyGb & \text{ is pcset}(\elkey\text{:}\elnum)\text{ if } \elnum = \rnGer \\
        \keyG  & \text{ is pcset}(\elkey\text{:}\elnum)\text{ if } \elnum = \rnVsev \\
    \end{cases}
\end{equation}

\begin{equation}
    \label{eq:key_not_found2}
    \setkey_\elpcset = \{ \keyfs, \keyFs, \keygb, \keyg, \keyGb, \keyG \}
\end{equation}

However, we can see that for the given key $\elkey = \keyC$,
$\elkey \not\in \setkey_\elpcset$. In this case, a
tonicization $\elden$ will be computed, such that
$\elden_\elkey \in \setkey_\elpcset$. The computed
tonicization $\elden$ must imply a ``closely related'' key
to $\elkey$, in order for the tonicization to be easily
interpretable in an \gls{rna} label.

One way to compute a ``closely related'' key is to use a
metric of key distance between $\elkey$ and all scale
degrees $\elden$ that satisfy $\elden_\elkey \in
\setkey_\elpcset$. The tonicization $\elden_{\min}$ with the
minimal distance to $\elkey$ is a good candidate for a
tonicization.

The key distance metric used is the Euclidean distance $d$
between $\elkey$ and all $\elden_\elkey \in
\setkey_\elpcset$ in the Weber tonal chart of keys
\parencite{weber1818versuch}. The chart is arranged in the
layout shown in \reftab{weber_tonal_chart}.

\phdtable[Weber's tonal chart of neighbouring keys.
Column-wise, the keys follow a \gls{lineoffifths}. Row-wise,
each key is surrounded by its relative and parallel major
(or minor) keys]{weber_tonal_chart}

Thus, the estimation of tonicization $\elden_{\min}$ is
shown in \refeq{tonicization_estimation}. For the example
above with $\elkey = \keyC$, this results in the
key-distance estimations shown in
\reftab{tonicization_estimation_example}.

\begin{equation}
    \label{eq:tonicization_estimation}
    \elden_{\min} = \text{arg min}_{\forall \elden_\elkey \in \setkey_\elpcset} d(\elkey, \elden_\elkey)
\end{equation}

\phdtable[Distance between the given key $\elkey$ and
tonicizations $\elden_\elkey \in \setkey_\elpcset$. The
$\elden_{\min}$ tonicization with the smallest distance,
$d(\elkey, \elden) = 1.0$, is
highlighted]{tonicization_estimation_example}

In the example provided, the tonicization $\elden_{\min}$
chosen would correspond to $\elden = \rnV$ and
$\elden_\elkey = \keyG$. When this tonicization is notated
in relation to the given key $\elkey$, the resulting
\gls{rna} label becomes $\rnwkeyton{C}{\rnVsev}{V}$. An
experienced analyst that observes the given \gls{pcset}
$\elpcset = \pcsetcega$ and key $\elkey = \keyC$ would
perhaps provide the same answer in a short time. 
% as there is a relation of \emph{dominant of the dominant}
% between the chord and key.
However, the relationships between chords and keys are not
always trivial, and the method provided facilitates a
programmatic way to obtain such \gls{rna} annotations. The
quality of the \gls{rna} labels provided by this method is
also heavily affected by the quality of the $\elpcset$ and
$\elkey$ predictions provided, which is the duty of the
machine learning model.
